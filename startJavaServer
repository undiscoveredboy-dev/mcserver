#!/bin/bash

set -e

MAIN_DIR="$PWD"
SERVER_DIR="$MAIN_DIR/server"
JAVA="$(command -v java)"

if [[ -z "$JAVA" ]]; then
  echo "Java not found. Run ./install first."
  exit 1
fi

if [[ ! -f "$SERVER_DIR/server.jar" ]]; then
  echo "server.jar not found in server/"
  exit 1
fi

cd "$SERVER_DIR"

# -----------------------------
# RAM detection
# -----------------------------
mem_kb=$(grep MemTotal /proc/meminfo | awk '{print $2}')
mem_gb=$((mem_kb / 1024 / 1024))

# Use 75% RAM (safe)
RAM=$((mem_gb * 75 / 100))

echo "Starting Minecraft with ${RAM}G RAM"
echo "Java path: $JAVA"

exec "$JAVA" -Xms${RAM}G -Xmx${RAM}G -jar server.jar nogui
