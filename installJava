#!/bin/bash

export THIS_DIR="$PWD"

install_server () {
  choice="$1"

  cd JavaInstallScripts || exit 1
  chmod +x *

  case "$choice" in
    ""|1)
      echo "> Installing Vanilla..."
      ./VanillaInstall
      ;;
    2)
      echo "> Installing Paper..."
      ./PaperInstall
      ;;
    3)
      echo "> Installing Forge..."
      ./ForgeInstall
      ;;
    4)
      echo "> Installing Sponge..."
      ./SpongeInstall
      ;;
    5)
      echo "> Installing Fabric..."
      ./FabricInstall
      ;;
    6)
      echo "> Installing Spigot..."
      ./SpigotInstall
      ;;
    7)
      echo "> Installing Bungeecord..."
      ./BungeecordInstall
      ;;
    *)
      echo "> Invalid response"
      cd "$THIS_DIR"
      ./installJava
      ;;
  esac
}

# -----------------------------
# Dependencies
# -----------------------------
sudo apt update -y
sudo apt install -y screen neofetch curl wget

echo "> Dependencies installed"

# -----------------------------
# Server directory
# -----------------------------
mkdir -p server

# -----------------------------
# Menu
# -----------------------------
echo ""
echo "-- Pick Server Type --"
echo "[1] Vanilla"
echo "[2] Paper"
echo "[3] Forge"
echo "[4] Sponge"
echo "[5] Fabric"
echo "[6] Spigot"
echo "[7] Bungeecord"
read -r choiceForServer

install_server "$choiceForServer"

cd "$THIS_DIR"

# -----------------------------
# Playit.gg install
# -----------------------------
echo "> Installing Playit.gg..."
curl -SsL https://playit-cloud.github.io/ppa/key.gpg | sudo apt-key add -
sudo curl -SsL -o /etc/apt/sources.list.d/playit-cloud.list \
  https://playit-cloud.github.io/ppa/playit-cloud.list
sudo apt update
sudo apt install -y playit

echo "> Playit.gg installed"

# -----------------------------
# Start prompt
# -----------------------------
echo ""
echo "Start server now?"
echo "[1] Yes"
echo "[2] No"
read -r StartServer

if [[ "$StartServer" == "1" ]]; then
  ./startserver
else
  echo "You can start later using: ./startserver"
fi
